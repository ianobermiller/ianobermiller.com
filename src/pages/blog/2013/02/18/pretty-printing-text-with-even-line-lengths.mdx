---
title: Pretty printing text with even line lengths
author: iano
type: post
date: 2013-02-19T07:31:15+00:00
url: /blog/2013/02/18/pretty-printing-text-with-even-line-lengths/
categories:
  - Algorithms
  - Dynamic Programming
  - JavaScript
---

The following demo pretty prints the entered text to the desired line width by making the lines as even as possible. The demo uses a dynamic programming algorithm to choose line breaks in such a way that the sum of the squares of the slack is minimized.

<!-- more -->

### Line length

<input id="line-length" type="number" value="46" />

### Basic wrapping

<textarea id="raw-text" rows="6">
  Call me Ishmael. Some years ago, never mind how long precisely, having little
  or no money in my purse, and nothing particular to interest me on shore, I
  thought I would sail about a little and see the watery part of the world.
</textarea>

### Formatted text

## Javascript Source

The javascript source, should work in any ES5 compatible browser:

```javascript
function prettyPrint(text, lineLength) {
    var words = text.split(' ');
    var lengths = words.map(function(w) { return w.length; });
    var opt = [];
    var index = [];
    for (var j = 0; j &lt; words.length; j++)
    {
        // Let i be the index that minimizes the expression slack(i, j) + opt[i – 1]
        var minIndex = -1;
        var minError = Number.MAX_VALUE;
        for (var i = 0; i &lt;= j; i++)
        {
            // Sum the lengths of words from i to j
            var len = sum(lengths.slice(i, j + 1).map(function(n) {return n + 1; })) - 1;

            // Slack is the distance from the end of the line
            var slack = lineLength - len;

            // If it is negative, we have picked up too many words
            if (slack &lt; 0) continue;

            // Error is equal to the slack squared plus the previous optimal error
            var error = slack * slack;
            if (i &gt; 0) error += opt[i - 1];

            // Save only the lowest error
            if (error &lt; minError)
            {
                minError = error;
                minIndex = i;
            }
        }
        opt[j] = minError;
        index[j] = minIndex;
    }

    // The minimum slack will be in opt[n – 1]
    // To reconstruct the lines:
    var x = words.length - 1;
    var lines = [];
    while (x &gt;= 0)
    {
        // Add line consisting of words from index[x] to x
        lines.unshift(words.slice(index[x], x + 1).join(' '));
        x = index[x] - 1;
    }
    return lines.join('\n');
}

function sum(numbers) {
    var s = 0;
    for (var i = 0; i &lt; numbers.length; i++) {
        s += numbers[i];
    }
    return s;
}

window.onload = function() {
    var pre = document.getElementById('formatted'),
        text = document.getElementById('raw-text'),
        length = document.getElementById('line-length');

    var ts = function() {
        text.setAttribute('cols', length.value);
        pre.innerText = (prettyPrint(text.value, Number(length.value)));
    };

    ts();

    length.onchange = length.onclick = text.onchange = text.onkeyup = text.onclick = ts;
};

```
